<form>
    <mat-label class="block">
        <label for="selectedUser">
            Users
        </label>
    </mat-label>
    <mat-form-field appearance="outline">
        <input matInput
               id="selectedUser"
               aria-label="Users"
               [matAutocomplete]="auto"
               [formControl]="control">
        <mat-autocomplete #auto="matAutocomplete"
                          (optionSelected)="onOptionSelected($event.option.value)"
                          [displayWith]="displayFn">
            <mat-option *rxFor="let user of filteredUsers$" [value]="user" [disabled]="user.disabled">
                    <mat-spinner *rxIf="isLoading"
                                 diameter="50">
                    </mat-spinner>

                <ng-container *rxIf="!isLoading">
                    <div class="flex flex-row items-center gap-3">
                        <div class="relative w-8 h-8">
                            <img *rxIf="user.profile.imageSrc"
                                 alt="{{user.username}}"
                                 ngSrc="{{user.profile.imageSrc}}"
                                 fill="true"
                                 class="object-cover rounded">
                            <div *rxIf="!user.profile.imageSrc"
                                 class="bg-gray-800 text-gray-200 w-8 h-8 flex items-center justify-center rounded">
                                <span class="text-lg uppercase">{{user.username | shortName}}</span>
                            </div>
                        </div>
                        <p>#{{user.username}}</p>
                    </div>
                </ng-container>

            </mat-option>
        </mat-autocomplete>
    </mat-form-field>

    <ul class="max-w-md divide-y divide-gray-200">
        <ng-container *rxFor="let user of selectedUsers$; let index = index;">
            <li class="pb-3 sm:pb-4">
                <div class="flex flex-row items-center gap-3">
                    <div class="relative w-8 h-8">
                        <img *rxIf="user.profile.imageSrc"
                             alt="{{user.username}}"
                             ngSrc="{{user.profile.imageSrc}}"
                             fill="true"
                             class="object-cover rounded">
                        <div *rxIf="!user.profile.imageSrc"
                             class="bg-gray-800 text-gray-200 w-8 h-8 flex items-center justify-center rounded">
                            <span class="text-lg uppercase">{{user.username | shortName}}</span>
                        </div>
                    </div>
                    <p>#{{user.username}}</p>
                    <button mat-flat-button
                            type="button"
                            (click)="removeSelectedUser(index)">
                        Remove
                    </button>
                </div>
            </li>
        </ng-container>
    </ul>
</form>
