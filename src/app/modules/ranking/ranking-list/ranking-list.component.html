<div class="layout-container layout-whitespace">

    <ng-container *rxLet="view$; let view;">
        <div class="grid grid-cols-4 gap-x-4 gap-y-6">

            <section class="col-start-1 col-span-full row-start-1">
                <div class="flex flex-row gap-2">
                    <div class="rounded-xl bg-gray-200 py-1 px-3">
                        <p class="text-gray-950">
                            Circle:
                        </p>
                    </div>
                    <div class="rounded-xl bg-gray-100 py-1 px-3 flex-1 flex flex-row gap-2">
                        <p class="text-gray-950">
                            <a [routerLink]="['/circles', view.circle.id]">
                                {{ view.circle.name }}
                            </a>
                        </p>
                        <i-feather name="arrow-right-circle"
                                   class="align-top">
                        </i-feather>
                    </div>
                </div>
            </section>

            <div class="col-start-1 col-span-2 row-start-2 md:col-span-1">
                <p>
                    Need a vote
                </p>
                <vyf-avatar-stack (stackClicked)="onShowMembers()"
                                  [users]="view.previewUsers"
                                  [plusCount]="view.membersCount">
                </vyf-avatar-stack>
            </div>

            <div class="col-start-3 col-span-2 row-start-2 md:col-start-4 md:col-span-1">
                <div class="flex flex-col place-items-end">
                    <p>
                        Valid until
                    </p>
                    <p>{{ view.circle.validUntil | date }}</p>
                    <p>{{ view.circle.validUntil | date:'shortTime' }}</p>
                </div>
            </div>

            <section class="col-span-full row-start-3 md:col-start-2 md:col-span-2 md:row-start-2">
                @if (view.topThreePlacements.length) {
                    <app-top-three [topThreePlacements]="view.topThreePlacements"
                                   [circle]="view.circle"
                                   class="animate-fade-up animate-once animate-duration-[850ms] animate-delay-[400ms] animate-ease-in-out">
                    </app-top-three>
                }

                <ul *rxIf="view.placements.length"
                    class="divide-y divide-gray-900">
                    @for (placement of view.placements; track placementTrackingBy($index, placement); ) {
                        <app-list-item [placement]="placement"
                                       [circle]="view.circle"
                                       [hasVotedFor]="view.userCandidateMember?.voter?.votedFor === placement.ranking.identityId"
                                       (click)="onShowItem(placement)"
                                       class="animate-fade-up animate-once animate-duration-[850ms] animate-delay-[400ms] animate-ease-in-out">
                        </app-list-item>
                    }
                </ul>
            </section>

            @if (!view.placements.length && !view.topThreePlacements.length) {
                <section class="col-span-full row-start-3 md:col-start-2 md:col-span-2 md:row-start-2">
                    <div class="relative h-60 w-60 mx-auto">
                        <img ngSrc="/assets/img/svg/election-day.svg"
                             priority="true"
                             alt="election vote"
                             fill="true"
                             class="object-cover select-none">
                    </div>

                    <h5 class="text-xl text-center my-6 font-normal tracking-wide">
                        No one has voted, <br>
                        <button mat-button
                                color="accent"
                                role="button"
                                type="button"
                                (click)="onShowMembers()">
                            give a vote!
                        </button>
                    </h5>
                </section>
            }
        </div>

    </ng-container>
</div>

