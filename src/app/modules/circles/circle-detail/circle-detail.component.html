<div class="layout-container layout-whitespace">
    <ng-container *rxLet="view$;
    let view;
    error: error;
    suspense: suspense;">
        <div class="flex flex-col gap-6">

            <div class="flex flex-row items-center justify-between">
                <div>
                    <a [routerLink]="['/circles']"
                       mat-button
                       color="accent">
                        Back to circles
                    </a>
                </div>
                <button mat-flat-button
                        color="accent"
                        role="button"
                        type="button"
                        (click)="onOpenSettings(view)">
                    Edit
                </button>
            </div>

            <div class="flex flex-row items-center justify-center">
                <div class="flex flex-row items-center gap-4">
                    <div *rxIf="view.circle.private"
                         class="flex flex-col items-center">
                        <mat-icon>
                            lock
                        </mat-icon>
                        <span class="text-gray-500 text-xs">Private</span>
                    </div>
                    <h2>
                        {{ view.circle.name }}
                    </h2>
                </div>
            </div>

            <figure class="relative h-[16rem] w-full">
                <img class="object-cover object-center md:blur-[2px] rounded"
                     ngSrc="{{view.circle.imageSrc.length ? view.circle.imageSrc : placeholderImageSrc}}"
                     alt="{{view.circle.name}}"
                     fill="true">
                <div class="relative mx-auto h-[16rem] w-full md:w-[16rem]">
                    <img class="object-cover object-center rounded-2xl"
                         ngSrc="{{view.circle.imageSrc.length ? view.circle.imageSrc : placeholderImageSrc}}"
                         alt="{{view.circle.name}}"
                         fill="true"
                         priority="true">
                </div>
            </figure>

            <div>
                <a [routerLink]="['/ranking', view.circle.id]"
                   mat-button
                   color="accent">
                    Go to Ranking List
                </a>
                <div *rxIf="hasOpenCommitment$">
                    You have been invited, give the owner the answer that you will be part of this circle.
                </div>
                <div class="border border-gray-400 p-2 w-1/2">
                    <vyf-circle-commitment-action (commitment)="hasCommitted(view.circle.id, $event)"
                                                  [selectedCommitment]="selectedCommitment$ | push">
                    </vyf-circle-commitment-action>
                </div>
            </div>

            <section id="circleMetaData"
                     class="flex flex-row justify-between">
                <div>
                    <h3>
                        Owner
                    </h3>
                    <vyf-circle-member [member]="view.owner"
                                       [opts]="circleMemberComponentOption">
                    </vyf-circle-member>
                </div>

                <div class="flex flex-col">
                    <h3 class="text-xl font-normal text-gray-900 mb-2">
                        Valid until
                    </h3>
                    <p>{{ view.circle.validUntil | date }}</p>
                    <p>{{ view.circle.validUntil | date:'shortTime' }}</p>
                </div>
            </section>

            <div>
                <h3>
                    Description
                </h3>
                <p class="md:max-w-5xl">
                    {{ view.circle.description }}
                </p>
            </div>

            <div>
                <h3>
                    Members
                </h3>
                <div *rxIf="view.members.length; else: noMembers"
                     class="flex flex-row gap-4 items-center">
                    <ng-container *rxFor="let member of view.members;">
                        <vyf-circle-member [member]="member"
                                           [opts]="circleMembersComponentOption">
                        </vyf-circle-member>
                    </ng-container>
                    <div class="w-14 h-14 rounded hover:text-gray-950 hover:font-semibold">
                        <a [routerLink]="['/circles', view.circle.id ,'members']"
                           class="w-full h-full flex flex-col justify-center items-center">
                            <div>
                                +{{ view.membersCount }}
                            </div>
                            <div>
                                -- -- --
                            </div>
                        </a>
                    </div>
                </div>

                <ng-template #noMembers>
                    <div>
                        <a [routerLink]="['/circles', view.circle.id, 'members']"
                           mat-button
                           color="accent">
                            <mat-icon>
                                add
                            </mat-icon>
                            There are no Members - Add some
                        </a>
                    </div>
                </ng-template>
            </div>

        </div>
    </ng-container>

    <ng-template #suspense>
        <div class="flex justify-center items-center">
            <mat-spinner></mat-spinner>
        </div>
    </ng-template>
    <ng-template #error>ERROR!</ng-template>
</div>
